<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Widget Annotation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>
    <style>

        /* Index level 1 */
        .label-on-left {
            margin-left: 3rem;
            --label-width: 12rem;
            --gap-width: 2rem;
        }

        .label-on-left + .label-on-left {
            margin-top: var(--sl-spacing-medium);
        }

        .label-on-left::part(form-control) {
            display: grid;
            grid: auto / var(--label-width) 1fr;
            gap: var(--sl-spacing-3x-small) var(--gap-width);
            align-items: center;
        }

        .label-on-left::part(form-control-input) {
            justify-self: end; 
            width: 100px;
        }

        .label-on-left::part(form-control-label) {
            text-align: right;
            flex: 1;
            width: 10rem;
        }

        .label-on-left::part(form-control-help-text) {
            grid-column-start: 2;
        }


        .label-on-left-upper {
            margin-top: 2rem;
            margin-bottom: 2rem;
            --label-width: 12rem;
            --gap-width: 2rem;
        }

        .label-on-left-upper + .label-on-left-upper {
            margin-top: var(--sl-spacing-medium);
        }

        .label-on-left-upper::part(form-control) {
            display: grid;
            grid: auto / var(--label-width) 1fr;
            gap: var(--sl-spacing-3x-small) var(--gap-width);
            align-items: center;
        }

        .label-on-left-upper::part(form-control-input) {
            justify-self: end; 
            width: 100px;
            background: #E3F2FF;
        }

        .label-on-left-upper::part(form-control-label) {
            text-align: left;
            flex: 1;
            width: 12rem;
            font-weight: var(--sl-font-weight-semibold);
        }

        .label-on-left-upper::part(form-control-help-text) {
            grid-column-start: 2;
        }

        hr.dashed {
        border-top: 2px dashed #bbb;
        }


        /* Clear floats after the columns */
        .container {
            display: flex; /* Use Flexbox for layout */
            gap: 20px; /* Adds 20px space between columns */
            padding-left: 20px;
            padding-right: 20px;
            justify-content: center; /* Center the columns horizontally */
        }

        .column:first-child {
            flex: 0 0 60%; /* Left column takes 70% of the container */
            max-width: 60%; /* Prevent it from growing larger than 70% */
        }

        .column:last-child {
            flex: 0 0 40%; /* Right column takes 30% of the container */
            max-width: 40%; /* Prevent it from growing larger than 30% */
        }

        .column img {
            max-width: 100%;
            height: auto; /* Ensure the image scales properly */
        }

        sl-button.primary::part(base) {
            background-color: #d7e9ff;
        }

        h1 {
            font-size: var(--sl-font-size-x-large);
            font-family: var(--sl-font-sans);
            font-weight: var(--sl-font-weight-bold);
            line-height: var(--sl-line-height-normal);
        }
        body {
            font-family: var(--sl-font-sans);
            font-size: var(--sl-font-size-medium);
        }

        sl-dropdown::part(panel) {
            width: 30em;
            background-color: var(--sl-panel-background-color, white); 
            border-radius: var(--sl-border-radius-medium);
            box-shadow: var(--sl-shadow-large);
        }

        .transition_button{
            width: 130px;
        }

        .level0{
            display: flex;
            align-items: center; 
            gap: 1rem;
        }

        .level1{
            font-size: var(--sl-font-size-medium);
            width: 500px;
        }

        .level2{
            display: inline-flex;
            width: 100%;
            font-size: var(--sl-font-size-medium);
            font-weight: var(--sl-font-weight-semibold);
        }

        .level2-first-flex-child{
            flex: 1
        }

        .number-style-level0{
            display: flex;
            align-items: center;
            justify-content: center; 
            background: #f9f8a7;
            border-radius: 50%;
            height: 30px;
            width: 30px;
        }

        .number-style-level1{
            display: flex;
            align-items: center;
            justify-content: center; 
            background: #E3F2FF;
            border-radius: 50%;
            height: 30px;
            width: 30px;
        }

        .reasoning-title{
            font-size: var(--sl-font-size-large);
        }

        .smaller-text{
            font-size: 0.875rem;
        }



    </style>
</head>

<body>
    <div class="container">
        <div class="column">
            <div id="video-scenes">
                <!-- Screenshots will be dynamically inserted here -->
            </div>
            <div id="llm-reasoning">
                <p class="reasoning-title"> Widget Description</p>
                <p class ="smaller-text" id="widget-content"></p>
                <!-- Prompt widget description will be dynamically inserted here -->
                <p class="reasoning-title"> Placement and Reasoning</p>
                <p class ="smaller-text" id="reasoning-context" style="white-space: pre-wrap;"></p>
                <!-- Reasoning text will be dynamically inserted here -->
            </div>
        </div>
        <div class="column">
            <h1>Deceptive Design Category Selection</h1>
            <sl-button variant="default" size="small" a href="https://drive.google.com/file/d/12K7xDdavPqzHip-8qBNFckEUqNAqw70v/view?usp=drive_link">
                <sl-icon slot="prefix" name="arrow-up-right-square"></sl-icon>
                View Taxonomoy
            </sl-button>
            <br/>

            <sl-divider></sl-divider>

            <div id="taxonomy-selection">
                <!-- Obstruction -->
                <div class="level0">
                    <sl-details class="level1" summary="Obstruction" >
                        <div class="level2">
                            <p class="level2-first-flex-child"> Roach Motel </p>
                            <p id="roach-motel-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="immortal-accounts-vote" value=0 label="Immortal accounts" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="dead-end-vote" value=0 label="Dead end" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Creating Barriers </p>
                            <p id="creating-barriers-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="price-comparison-prevention-vote" value=0 label="Price comparison prevention" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="intermediate-currency-vote" value=0 label="Intermediate currency" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Adding Steps </p>
                            <p id="adding-steps-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="privacy-maze-vote" value=0 label="Privacy maze" type="number" placeholder="0"></sl-input>

                    </sl-details>
                    <p id="obstruction-sum" value=0 class="number-style-level0">0</p>
                </div>

                <!-- Sneaking -->
                <div class="level0">
                    <sl-details class="level1" summary="Sneaking" >
                        <div class="level2">
                            <p class="level2-first-flex-child"> Bait and Switch </p>
                            <p id="bait-and-switch-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="disguised-ad-vote" value=0 label="Disguised ad" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="disguised-sign-up-vote" value=0 label="Disguised sign-up" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Hiding information </p>
                            <p id="hiding-information-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="sneak-into-basket-vote" value=0 label="Sneak into basket" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="drip-pricing-vote" value=0 label="Drip pricing, hidden costs, or paritioned pricing" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="reference-pricing-vote" value=0 label="Reference pricing" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> (De)contextualizing Cues </p>
                            <p id="(de)contextualizing-cues-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="conflicting-information-vote" value=0 label="Confliciting information" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="information-without-context-vote" value=0 label="Information without context" type="number" placeholder="0"></sl-input>

                    </sl-details>
                    <p id="sneaking-sum" value=0 class="number-style-level0">0</p>
                </div>

                <!-- Interface Interference -->
                <div class="level0">
                    <sl-details class="level1" summary="Interface Interference" >
                        <div class="level2">
                            <p class="level2-first-flex-child"> Manipulating Choice Architecture </p>
                            <p id="manipulating-choice-architecture-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="false-hierarchy-vote" value=0 label="False hierarchy" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="visual-prominence-vote" value=0 label="Visual prominence" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="bundling-vote" value=0 label="Bundling" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="first-place-positioning-vote" value=0 label="First place positioning" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="fake-data-comparison-vote" value=0 label="Fake data comparison" type="number" placeholder="0"></sl-input>
                    
                        <sl-input class="label-on-left-upper" id="bad-defaults-sum" value=0 label="Bad defaults" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Emotional or Sensory Manipulation </p>
                            <p id="emotional-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="cuteness-vote" value=0 label="Cuteness" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="positive-vote" value=0 label="Positive or negative framing" type="number" placeholder="0"></sl-input>

                        <sl-input class="label-on-left-upper" id="trick-questions-sum" value=0 label="Trick Questions" type="number" placeholder="0"></sl-input>
                        
                        <sl-input class="label-on-left-upper" id="choice-overload-sum" value=0 label="Choice Overload" type="number" placeholder="0"></sl-input>
                        
                        <sl-input class="label-on-left-upper" id="hidden-information-sum" value=0 label="Hidden Information" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Language Inaccessibility </p>
                            <p id="language-inaccessibility-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="wrong-language-vote" value=0 label="Wrong language" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="complex-language-vote" value=0 label="Complex language" type="number" placeholder="0"></sl-input>

                        <sl-input class="label-on-left-upper" id="feedward-ambiguity-sum" value=0 label="Feedward ambiguity" type="number" placeholder="0"></sl-input>

                    </sl-details>
                    <p id="interface-interference-sum" value=0 class="number-style-level0">0</p>
                </div>

                <!-- Forced Action -->
                <div class="level0">
                    <sl-details class="level1" summary="Forced Action" >

                        <sl-input class="label-on-left-upper" id="nagging-sum" value=0 label="Nagging" type="number" placeholder="0"></sl-input>

                        <sl-input class="label-on-left-upper" id="forced-continuity-sum" value=0 label="Forced Continuity" type="number" placeholder="0"></sl-input>

                        <sl-input class="label-on-left-upper" id="forced-registration-sum" value=0 label="Forced Registration" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Forced Communication or Disclosure </p>
                            <p id="forced-communication-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="privacy-zukering-vote" value=0 label="Privacy zukering" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="friend-spam-vote" value=0 label="Friend spam" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="address-book-leeching-vote" value=0 label="Address book leeching" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="social-pyramid-vote" value=0 label="Social pyramid" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Gamification </p>
                            <p id="gamification-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="pay-to-play-vote" value=0 label="Pay-to-play" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="grinding-vote" value=0 label="Grinding" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Attention Capture </p>
                            <p id="attention-capture-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="auto-play-vote" value=0 label="Auto-play" type="number" placeholder="0"></sl-input>

                    </sl-details>
                    <p id="forced-action-sum" value=0 class="number-style-level0">0</p>
                </div>


                <!-- Social Engineering -->
                <div class="level0">
                    <sl-details class="level1" summary="Social Engineering" >

                        <div class="level2">
                            <p class="level2-first-flex-child"> Scarcity and Popularity Claims </p>
                            <p id="scarcity-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="high-demand-vote" value=0 label="High demand" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="(Fake)-discount-vote" value=0 label="(Fake) Discount" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Social Proof </p>
                            <p id="social-proof-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="low-stock-vote" value=0 label="Low stock" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="endorsement-vote" value=0 label="Endorsement and testimonials" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="parasocial-vote" value=0 label="Parasocial pressure" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Urgency </p>
                            <p id="urgency-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="activity-messages-vote" value=0 label="Activity messages" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="countdown-timer-vote" value=0 label="Countdown timer" type="number" placeholder="0"></sl-input>
                        <sl-input class="label-on-left" id="limited-time-vote" value=0 label="Limited time message" type="number" placeholder="0"></sl-input>

                        <div class="level2">
                            <p class="level2-first-flex-child"> Personalization </p>
                            <p id="personalization-sum" class="number-style-level1">0</p>
                        </div>
                        <sl-input class="label-on-left" id="confirmshaming-vote" value=0 label="Confirmshaming" type="number" placeholder="0"></sl-input>
                    </sl-details>
                    <p id="social-engineering-sum" value=0 class="number-style-level0">0</p>
                </div>
            </div>

            <sl-checkbox size="medium" id="not-sure" style="margin-top:2rem; margin-right: 5rem;">I'm not sure</sl-checkbox>
            <sl-checkbox size="medium" id="no-dd" style="margin-top:2rem;">No dark pattern</sl-checkbox>

            <br/>   
            <sl-textarea rows="5" id="explanation-text" style="margin-top: 3rem; margin-top: 1rem;" label="Which elements use deceptive designs? Provide one explanation per deceptive design instance." help-text="Example: Visual Prominence - 'Buy More' buttons on the shipment tracking page are a deceptive design meant to distract users from completing their original task."></sl-textarea>
            <br/>
            <sl-divider></sl-divider>
            <sl-button variant="default" id="prev-button" class="transition_button">
                <sl-icon slot="prefix" name="arrow-left"></sl-icon>
                Previous
            </sl-button>
            <sl-button variant="default" id="next-button" class="transition_button">
                <sl-icon slot="suffix" name="arrow-right"></sl-icon>
                Next
            </sl-button>

    <script>

        // Function to add sum to the middle-level category
        function add_votes_medium(sum_list, final_id){
            final_element = document.getElementById(final_id); // Final output
            var selectionLength = sum_list.length; // How many categories are inside

            var updateNumber = 0;

            for (var i = 0; i < selectionLength; i++) {
                const element = document.getElementById(sum_list[i]);
                if (element.tagName === "SL-INPUT"){
                    updateNumber += parseInt(document.getElementById(sum_list[i]).value); // Add category vote number to updateNumber
                } else {
                    updateNumber += parseInt(document.getElementById(sum_list[i]).textContent); // Add category vote number to updateNumber
                }
            }

            final_element.textContent = updateNumber; // Update the medium level number of corresponding category);
        }

        // Highl-level: Obstruction Field

        // Roach Motels
        document.getElementById("immortal-accounts-vote").addEventListener("input", () => {
            add_votes_medium(["immortal-accounts-vote", "dead-end-vote"], "roach-motel-sum");
            add_votes_medium(["roach-motel-sum", "creating-barriers-sum", "adding-steps-sum"], "obstruction-sum");
        });

        document.getElementById("dead-end-vote").addEventListener("input", () => {
            add_votes_medium(["immortal-accounts-vote", "dead-end-vote"], "roach-motel-sum");
            add_votes_medium(["roach-motel-sum", "creating-barriers-sum", "adding-steps-sum"], "obstruction-sum");
        });

        // Creating Barriers
        document.getElementById("price-comparison-prevention-vote").addEventListener("input", () => {
            add_votes_medium(["price-comparison-prevention-vote", "intermediate-currency-vote"], "creating-barriers-sum");
            add_votes_medium(["roach-motel-sum", "creating-barriers-sum", "adding-steps-sum"], "obstruction-sum");
        });

        document.getElementById("intermediate-currency-vote").addEventListener("input", () => {
            add_votes_medium(["price-comparison-prevention-vote", "intermediate-currency-vote"], "creating-barriers-sum");
            add_votes_medium(["roach-motel-sum", "creating-barriers-sum", "adding-steps-sum"], "obstruction-sum");
        });

        // Adding Steps
        document.getElementById("privacy-maze-vote").addEventListener("input", () => {
            add_votes_medium(["privacy-maze-vote"], "adding-steps-sum");
            add_votes_medium(["roach-motel-sum", "creating-barriers-sum", "adding-steps-sum"], "obstruction-sum");
        });

        // High-level: Sneaking
        // Bait and Switch
        document.getElementById("disguised-ad-vote").addEventListener("input", () => {
            add_votes_medium(["disguised-ad-vote", "disguised-sign-up-vote"], "bait-and-switch-sum");
            add_votes_medium(["bait-and-switch-sum", "hiding-information-sum", "(de)contextualizing-cues-sum"], "sneaking-sum");
        });

        document.getElementById("disguised-sign-up-vote").addEventListener("input", () => {
            add_votes_medium(["disguised-ad-vote", "disguised-sign-up-vote"], "bait-and-switch-sum");
            add_votes_medium(["bait-and-switch-sum", "hiding-information-sum", "(de)contextualizing-cues-sum"], "sneaking-sum");
        });

        // Hiding Information
        document.getElementById("sneak-into-basket-vote").addEventListener("input", () => {
            add_votes_medium(["sneak-into-basket-vote", "drip-pricing-vote", "reference-pricing-vote"], "hiding-information-sum");
            add_votes_medium(["bait-and-switch-sum", "hiding-information-sum", "(de)contextualizing-cues-sum"], "sneaking-sum");
        });

        document.getElementById("drip-pricing-vote").addEventListener("input", () => {
            add_votes_medium(["sneak-into-basket-vote", "drip-pricing-vote", "reference-pricing-vote"], "hiding-information-sum");
            add_votes_medium(["bait-and-switch-sum", "hiding-information-sum", "(de)contextualizing-cues-sum"], "sneaking-sum");
        });


        document.getElementById("reference-pricing-vote").addEventListener("input", () => {
            add_votes_medium(["sneak-into-basket-vote", "drip-pricing-vote", "reference-pricing-vote"], "hiding-information-sum");
            add_votes_medium(["bait-and-switch-sum", "hiding-information-sum", "(de)contextualizing-cues-sum"], "sneaking-sum");
        });

        // (De)contextualizing Cues
        document.getElementById("conflicting-information-vote").addEventListener("input", () => {
            add_votes_medium(["conflicting-information-vote", "information-without-context-vote"], "(de)contextualizing-cues-sum");
            add_votes_medium(["bait-and-switch-sum", "hiding-information-sum", "(de)contextualizing-cues-sum"], "sneaking-sum");
        });

        document.getElementById("information-without-context-vote").addEventListener("input", () => {
            add_votes_medium(["conflicting-information-vote", "information-without-context-vote"], "(de)contextualizing-cues-sum");
            add_votes_medium(["bait-and-switch-sum", "hiding-information-sum", "(de)contextualizing-cues-sum"], "sneaking-sum");
        });

        // High-level: Interface Interference
        // Manipulating Choice Architecture
        document.getElementById("false-hierarchy-vote").addEventListener("input", () => {
            add_votes_medium(["false-hierarchy-vote", "visual-prominence-vote", "bundling-vote", "first-place-positioning-vote", "fake-data-comparison-vote"], "manipulating-choice-architecture-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        document.getElementById("visual-prominence-vote").addEventListener("input", () => {
            add_votes_medium(["false-hierarchy-vote", "visual-prominence-vote", "bundling-vote", "first-place-positioning-vote", "fake-data-comparison-vote"], "manipulating-choice-architecture-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        document.getElementById("bundling-vote").addEventListener("input", () => {
            add_votes_medium(["false-hierarchy-vote", "visual-prominence-vote", "bundling-vote", "first-place-positioning-vote", "fake-data-comparison-vote"], "manipulating-choice-architecture-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        document.getElementById("first-place-positioning-vote").addEventListener("input", () => {
            add_votes_medium(["false-hierarchy-vote", "visual-prominence-vote", "bundling-vote", "first-place-positioning-vote", "fake-data-comparison-vote"], "manipulating-choice-architecture-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        document.getElementById("fake-data-comparison-vote").addEventListener("input", () => {
            add_votes_medium(["false-hierarchy-vote", "visual-prominence-vote", "bundling-vote", "first-place-positioning-vote", "fake-data-comparison-vote"], "manipulating-choice-architecture-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        // Bad defaults
        document.getElementById("bad-defaults-sum").addEventListener("input", () => {
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        // Emotional or Sensory Manipulation
        document.getElementById("cuteness-vote").addEventListener("input", () => {
            add_votes_medium(["cuteness-vote", "positive-vote"], "emotional-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        document.getElementById("positive-vote").addEventListener("input", () => {
            add_votes_medium(["cuteness-vote", "positive-vote"], "emotional-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        // Trick Questions
        document.getElementById("trick-questions-sum").addEventListener("input", () => {
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        // Choice Overload
        document.getElementById("choice-overload-sum").addEventListener("input", () => {
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        // Hidden Information
        document.getElementById("hidden-information-sum").addEventListener("input", () => {
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        // Language Inaccessibility
        document.getElementById("wrong-language-vote").addEventListener("input", () => {
            add_votes_medium(["wrong-language-vote", "complex-language-vote"], "language-inaccessibility-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        document.getElementById("complex-language-vote").addEventListener("input", () => {
            add_votes_medium(["wrong-language-vote", "complex-language-vote"], "language-inaccessibility-sum");
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });

        // Feedward Ambiguity
        document.getElementById("feedward-ambiguity-sum").addEventListener("input", () => {
            add_votes_medium(["manipulating-choice-architecture-sum", "bad-defaults-sum", "emotional-sum", "trick-questions-sum", "choice-overload-sum", "hidden-information-sum", "language-inaccessibility-sum", "feedward-ambiguity-sum"], "interface-interference-sum");
        });


        // High-level: Forced Action
        // Nagging
        document.getElementById("nagging-sum").addEventListener("input", () => {
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        // Forced Continuity
        document.getElementById("forced-continuity-sum").addEventListener("input", () => {
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        // Forced Registration
        document.getElementById("forced-registration-sum").addEventListener("input", () => {
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        // Forced Communication or Disclosure
        document.getElementById("privacy-zukering-vote").addEventListener("input", () => {
            add_votes_medium(["privacy-zukering-vote", "friend-spam-vote", "address-book-leeching-vote", "social-pyramid-vote"], "forced-communication-sum");
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        document.getElementById("friend-spam-vote").addEventListener("input", () => {
            add_votes_medium(["privacy-zukering-vote", "friend-spam-vote", "address-book-leeching-vote", "social-pyramid-vote"], "forced-communication-sum");
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        document.getElementById("address-book-leeching-vote").addEventListener("input", () => {
            add_votes_medium(["privacy-zukering-vote", "friend-spam-vote", "address-book-leeching-vote", "social-pyramid-vote"], "forced-communication-sum");
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        document.getElementById("social-pyramid-vote").addEventListener("input", () => {
            add_votes_medium(["privacy-zukering-vote", "friend-spam-vote", "address-book-leeching-vote", "social-pyramid-vote"], "forced-communication-sum");
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        // Gamification
        document.getElementById("pay-to-play-vote").addEventListener("input", () => {
            add_votes_medium(["pay-to-play-vote", "grinding-vote"], "gamification-sum");
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        document.getElementById("grinding-vote").addEventListener("input", () => {
            add_votes_medium(["pay-to-play-vote", "grinding-vote"], "gamification-sum");
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

        // Attention Capture
        document.getElementById("auto-play-vote").addEventListener("input", () => {
            add_votes_medium(["auto-play-vote"], "attention-capture-sum");
            add_votes_medium(["nagging-sum", "forced-continuity-sum", "forced-registration-sum", "forced-communication-sum", "gamification-sum","attention-capture-sum"], "forced-action-sum");
        });

       // High-level: Social Engineering
       // Scarcity and Popularity Claims
        document.getElementById("high-demand-vote").addEventListener("input", () => {
            add_votes_medium(["high-demand-vote", "(Fake)-discount-vote"], "scarcity-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });
     
        document.getElementById("(Fake)-discount-vote").addEventListener("input", () => {
            add_votes_medium(["high-demand-vote", "(Fake)-discount-vote"], "scarcity-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });

       // Social Proof
       document.getElementById("low-stock-vote").addEventListener("input", () => {
            add_votes_medium(["low-stock-vote", "endorsement-vote", "parasocial-vote"], "social-proof-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });

        document.getElementById("endorsement-vote").addEventListener("input", () => {
            add_votes_medium(["low-stock-vote", "endorsement-vote", "parasocial-vote"], "social-proof-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });

        document.getElementById("parasocial-vote").addEventListener("input", () => {
            add_votes_medium(["low-stock-vote", "endorsement-vote", "parasocial-vote"], "social-proof-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });

        // Urgency
        document.getElementById("activity-messages-vote").addEventListener("input", () => {
            add_votes_medium(["activity-messages-vote", "countdown-timer-vote", "limited-time-vote"], "urgency-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });

        document.getElementById("countdown-timer-vote").addEventListener("input", () => {
            add_votes_medium(["activity-messages-vote", "countdown-timer-vote", "limited-time-vote"], "urgency-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });

        document.getElementById("limited-time-vote").addEventListener("input", () => {
            add_votes_medium(["activity-messages-vote", "countdown-timer-vote", "limited-time-vote"], "urgency-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });

        // Personalization
        document.getElementById("confirmshaming-vote").addEventListener("input", () => {
            add_votes_medium(["confirmshaming-vote"], "personalization-sum");
            add_votes_medium(["scarcity-sum", "social-proof-sum", "urgency-sum", "personalization-sum"], "social-engineering-sum");
        });




        // Select no DD, unselect other DD input boxes
        document.getElementById("no-dd").addEventListener("sl-change", function(){
            if (this.checked){
                const taxonomyDiv = document.getElementById("taxonomy-selection");
                const inputs = taxonomyDiv.querySelectorAll("sl-input");
                const number_outputs = taxonomyDiv.querySelectorAll("p");
                inputs.forEach(input => {
                    console.log(input.value);
                    input.value = 0;
                });

                number_outputs.forEach(output => {
                    let output_item = parseInt(output.textContent);
                    if (Number.isNaN(output_item)){
                        // Do nothing if it is a text
                    } else{
                        output.textContent = 0;
                    };
                });
            }
        });


        async function fetchVideoData() {
            const response = await fetch('widget_data.json');
                
            if (response) {
                console.log("Data JSON fetch succeeded")
                return await response.json();}
        }

        function getQueryParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            console.log(urlParams.get(name));
            return urlParams.get(name);
        }

        let videoSource = {};

        async function createVideoScene(videoPair) {
            const scene = document.createElement('div');

            scene.innerHTML = `
            <div>
                <h2><Widget Image</h2>
                <img alt="design_screenshot sizes="print 73px,117px" src="${videoPair.screenshot_location}">
            </div>
            `;

            // Get widget description
            const description_prompt = videoPair.Description;
            document.getElementById("widget-content").textContent = description_prompt;

            // Get LLM reasoning
            const txt_location = videoPair.screenshot_location.replace(".png", ".txt");

            console.log("txt location", txt_location);
            
            fetch(txt_location)
                .then(response => response.text())
                .then(text => {
                    console.log("txt content", text);
                    document.getElementById("reasoning-context").textContent = text;
                })
                .catch(error => {
                    console.error("Error fetching text:", error);
                    document.getElementById("reasoning-context").textContent ="Fail to load text.";
                });
                

            const response = await fetch('https://rate.chenziwei0499.workers.dev/get', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ key: getQueryParameter('videoIndex') + getQueryParameter('user') })
            });


            let data = {};
            try {
            const text = await response.text();
            if (text.trim()) {
                data = JSON.parse(text);
            } else {
                console.warn('Empty response from /get endpoint');
                return scene; // Skip processing this entry
            }
            } catch (err) {
            console.error('Failed to parse JSON:', err);
            return scene;
            }

            const parsed = data; 

            console.log("parsed", parsed)
            console.log("parsed type", typeof parsed)
            parsed_dict = JSON.parse(parsed)

            // Get dark pattern type and explanation text
            dark_pattern_type = parsed_dict.value.dark_pattern_type
            explanation = parsed_dict.value.explanation

            // Get text back to the textbox
            document.getElementById("explanation-text").value = explanation;

            // Get bucket 1, 2, 3
            const bucket1 = dark_pattern_type[0];
            console.log("dark_pattern_type bucket1", typeof bucket1, bucket1)

            const bucket2 = dark_pattern_type[1];
            console.log("dark_pattern_type bucket2", typeof bucket2, bucket2)

            const bucket3 = dark_pattern_type[2];
            console.log("dark_pattern_type bucket3", typeof bucket3, bucket3)

            // If the widget has not been displayed before
            if (bucket1)

            // Return number to input field
            for (const key in bucket1) {
                const bucket1_value = bucket1[key];

                console.log("value type", typeof bucket1_value, bucket1_value)

                // If the widget has not been displayed before, the answer section will be null
                try{
                    document.getElementById(key).value = bucket1_value;
                } catch {
                    console.log("First time seeing the widget");
                }
            };

            // Return number to p field
            for (const key2 in bucket2) {
                const bucket2_value = bucket2[key2];

                // If the widget has not been displayed before, the answer section will be null
                try{
                    document.getElementById(key2).textContent = bucket2_value;
                } catch {
                    console.log("First time seeing the widget");
                }
            };

            // Return checkbox value to checkbox
            for (const key3 in bucket3) {
                const bucket3_value = bucket3[key3];

                // If the widget has not been displayed before, the answer section will be null
                try{
                    document.getElementById(key3).checked = bucket3_value;
                } catch {
                    console.log("First time seeing the widget");
                }
            };


            // If there is no value, skip this scene
            if (dark_pattern_type === "") {
                console.warn("Missing or malformed data:", parsed);
                return scene;
            }

            return scene;
        }
        
        async function showScene() {
            const videoData = await fetchVideoData();
            console.log("Video Data :" + JSON.stringify(videoData));
            const videoIndex = getQueryParameter('videoIndex');
            const videoScenes = document.getElementById('video-scenes');
            videoScenes.innerHTML = '<p> Current widget index: ' + videoIndex;
    

            if (videoIndex !== null && videoIndex < videoData.length && videoIndex >= 0) {
                console.log("Video Data[index]: "+ JSON.stringify(videoData[videoIndex]));
                const scene = await createVideoScene(videoData[videoIndex]);
                videoSource = videoData[videoIndex];
                console.log("scene:", scene)
                videoScenes.appendChild(scene);
            } else {
                videoScenes.innerHTML = `
                    <p><strong>Invalid image index</strong></p>
                    <p> Current video index is ${videoIndex}. Total index is ${videoData.length}.</p>
                `;
            }

        }

        // Initialize by showing the scene based on the URL parameter
        showScene();

        function collectData() {
            const taxonomyDiv = document.getElementById("taxonomy-selection");

            // Get votes for meso(have no low-level) and low-level patterns
            const inputs = taxonomyDiv.querySelectorAll("sl-input");

            // Get votes for meso(have low-level) and high-level patterns
            const number_outputs = taxonomyDiv.querySelectorAll("p");

            // Empty dictionary
            const bucket1 = {};
            const bucket2 = {};
            const bucket3 = {};

            // Save into a dictionary
            inputs.forEach(input => {
                bucket1[input.id] = parseInt(input.value);
                console.log(bucket1)
            });


            number_outputs.forEach(output => {
                let output_item = parseInt(output.textContent);
                if (Number.isNaN(output_item)){
                    // Do nothing if it is a text
                } else{
                    bucket2[output.id] = output_item;
                };
            });

            // Save selection whether not sure and no dd are selected
            bucket3["not-sure"] = document.getElementById("not-sure").checked;
            bucket3["no-dd"] = document.getElementById("no-dd").checked;


            // Save selection into an empty list
            const saved_list = [bucket1, bucket2, bucket3];

            // Explanation text
            const explanation_text = document.getElementById('explanation-text').value;

            const urlParams = new URLSearchParams(window.location.search);
            const videoIndex = urlParams.get('videoIndex');

            // Save deceptive design categories and explanation text
            const data = {
                dark_pattern_type: saved_list,
                explanation: explanation_text
            }
            return data;
        }


        async function uploadData() {
            const data = collectData();
            Toast('Uploading data...', 1000);
            let myuuid = crypto.randomUUID();
            const response = await fetch('https://rate.chenziwei0499.workers.dev/upload', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    key: myuuid,
                    index: getQueryParameter('videoIndex'),
                    rater: getQueryParameter('user')
                })
            });

            const response1 = await fetch('https://rate.chenziwei0499.workers.dev/put', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    key: getQueryParameter('videoIndex') + getQueryParameter('user'),
                    rater: getQueryParameter('user'),
                    value: data
                    })
            });
            await Toast(JSON.stringify(await response1.json()), 1000);
        }

        async function goToNextScene() {
            const videoIndex = parseInt(getQueryParameter('videoIndex'), 10);
            await uploadData();
            const nextIndex = isNaN(videoIndex) ? 0 : videoIndex + 1;
            console.log("Next Scene Index is :"+ nextIndex)
            window.location.search = `?videoIndex=${nextIndex}&user=${getQueryParameter('user')}`;

        }

        async function goToPrevScene() {
            const videoIndex = parseInt(getQueryParameter('videoIndex'), 10);
            await uploadData();
            const nextIndex = isNaN(videoIndex) ? 0 : videoIndex - 1;
            window.location.search = `?videoIndex=${nextIndex}&user=${getQueryParameter('user')}`;
        }

        async function Toast(msg, duration) {
            duration = isNaN(duration) ? 3000 : duration;
            var m = document.createElement('div');
            m.textContent = msg;
            m.style.cssText = "max-width:60%;min-width: 150px;padding:0 14px;height: 40px;color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);z-index: 999999;background: rgba(0, 0, 0,.7);font-size: 16px;";
            document.body.appendChild(m);
            setTimeout(function () {
                var d = 0.5;
                m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';
                m.style.opacity = '0';
                setTimeout(function () { document.body.removeChild(m) }, d * 1000);
            }, duration);
            // wait for the toast to disappear
            await new Promise(r => setTimeout(r, duration));
        }


        document.getElementById('next-button').addEventListener('click', goToNextScene);
        document.getElementById('prev-button').addEventListener('click', goToPrevScene);
    </script>
</body>

</html>